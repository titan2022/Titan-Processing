# Titan Processing

## Building
### Linux
1. Install OpenCV 4.8.x or above with Aruco contrib module, and Python support if using `calibration.py`
1. Install [nlohmann/json](https://github.com/nlohmann/json) using [vcpkg](https://github.com/Microsoft/vcpkg). If you want to install vcpkg using our binaries, do:
  ```bash
  curl -OL https://github.com/ethanc8/titanian-repo/raw/master/debian/pool/main/v/vcpkg/vcpkg_2023.12.10-2+titan2022_amd64.deb
  sudo apt install ./vcpkg_2023.12.10-2+titan2022_amd64.deb
  vcpkg install nlohmann-json
  ```
2. Run to generate Makefile and link vcpkg with CMake
```bash
mkdir build && cd build
cmake -B . -S .. -DCMAKE_TOOLCHAIN_FILE=[PATH TO VCPKG]/scripts/buildsystems/vcpkg.cmake

# If installed via our binaries 
cmake -B . -S .. -DCMAKE_TOOLCHAIN_FILE=/opt/vcpkg/scripts/buildsystems/vcpkg.cmake

# clangd support and examples
cmake -B . -S .. -DCMAKE_TOOLCHAIN_FILE=/opt/vcpkg/scripts/buildsystems/vcpkg.cmake -DCMAKE_EXPORT_COMPILE_COMMANDS=1 -DBUILD_EXAMPLES=1
```
* If you want to use `clangd` in your IDE, add `-DCMAKE_EXPORT_COMPILE_COMMANDS=1` to the end of the CMake commands
* Also works with Ninja build system
1. Run `make -j` to build
2. Done! Example binaries generated in `/bin`
### Build options
* `-DBUILD_EXAMPLES`: builds example files (found in `example/` folder)
* `-DNO_REALSENSE`: builds without RealSense code for compatiblity
## Config
* `ip`, `port`: UDP server IP/port
* `threads`: threads per camera stream
* `quadDecimate`: n/a
* `quadSigma`: n/a
* `decodeSharpening`: n/a
* `cameras`
  * `name`: keyword that will be matched when selecting camera stream
  * `width`, `height`, `fps`, `exposure`: stream parameters (Camset is helpful)
  * Everything else is generated by `calibration.py`
* `apriltags`
  * `id`: id
  * `position`: field position in meters
  * `rotation`: field rotation in degrees
  * `size`: Apriltag size in meters
## Other tools
* [Camset](https://github.com/azeam/camset)
  * Quick way to calibrate OpenCV camera parameters
* [calibration.py](tools/calibration.md)
  * Calibrating camera matrix and distortion coefficients
  * Use ChArUco board generator and print it
  * Take pictures with `[space]` (best to try multiple angles, 20+ photos)
* [Java networking server example](test/java/NetworkingServer.java)
  * UDP server for networking values
  * All types implimented